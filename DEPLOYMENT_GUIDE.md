# Deployment Guide for Render

## 🚀 Deployment Configuration

Your application is now configured for deployment on Render. All localhost references have been removed and the setup uses environment variables for flexibility.

## 📋 Pre-Deployment Checklist

### 1. Environment Variables to Set in Render Dashboard

After deploying, you **MUST** manually set these environment variables in the Render dashboard:

#### Backend Service (`university-verifier-backend`)
- **OPENAI_API_KEY**: Your OpenAI API key (required for AI features)
- **UNIVERSITY_PORTAL_URL**: URL of your portal service (e.g., `https://university-verifier-portal.onrender.com`)
- **CORS_ORIGIN**: `*` (or specific frontend URL for security)

#### Frontend Service (`university-verifier-frontend`)
- **VITE_API_URL**: Your backend URL with `/api/v1` path
  - Example: `https://university-verifier-backend.onrender.com/api/v1`

#### Portal Service (`university-verifier-portal`)
- **SECRET_KEY**: Auto-generated by Render (or set manually)

### 2. Deployment Steps

1. **Push your code to GitHub**
   ```bash
   git add .
   git commit -m "Configure for Render deployment"
   git push origin main
   ```

2. **Create Render Account**
   - Go to [render.com](https://render.com)
   - Sign up or log in with GitHub

3. **Deploy Using Blueprint (Recommended)**
   - Click "New" → "Blueprint"
   - Connect your GitHub repository
   - Select `render.yaml`
   - Render will automatically create all three services

4. **Set Environment Variables**
   - Go to each service in Render dashboard
   - Navigate to "Environment" tab
   - Add the required environment variables listed above

5. **Trigger Redeploy**
   - After setting environment variables, trigger a manual deploy
   - Wait for all services to be healthy

## 🔧 Configuration Changes Made

### Frontend (`frontend/`)
- ✅ Removed localhost fallback from `axios.js`
- ✅ Updated `vite.config.js` to use environment variables
- ✅ API URL now comes from `VITE_API_URL` environment variable

### Backend (`backend/`)
- ✅ Uses `PORT` and `HOST` from environment variables
- ✅ Dockerfile configured to bind to `0.0.0.0:${PORT}`
- ✅ Default port set to 10000 (Render's standard)

### University Portal (`university-portal/`)
- ✅ Uses `PORT` and `HOST` from environment variables
- ✅ Dockerfile configured properly
- ✅ Temporary storage configured for `/tmp` (Render's ephemeral storage)

### Render Configuration (`render.yaml`)
- ✅ All services configured with proper ports (10000)
- ✅ Environment variables set up for dynamic configuration
- ✅ Health check endpoints configured
- ✅ Static site serving configured for frontend

## 🎯 Post-Deployment Testing

After deployment, test the following:

1. **Backend Health Check**
   ```bash
   curl https://your-backend-url.onrender.com/api/v1/health
   ```

2. **Portal Health Check**
   ```bash
   curl https://your-portal-url.onrender.com/health
   ```

3. **Frontend Access**
   - Open `https://your-frontend-url.onrender.com` in browser
   - Verify it loads correctly

4. **End-to-End Test**
   - Upload a certificate through the frontend
   - Verify it processes correctly
   - Check if AI extraction works (requires OPENAI_API_KEY)

## 🐛 Troubleshooting

### Service Won't Start
- Check logs in Render dashboard
- Verify all environment variables are set
- Ensure PORT is set to 10000

### Frontend Can't Connect to Backend
- Verify VITE_API_URL is set correctly
- Include `/api/v1` in the URL path
- Check CORS_ORIGIN is set to `*` or your frontend URL

### AI Features Not Working
- Verify OPENAI_API_KEY is set in backend environment
- Check backend logs for API errors

### Portal Can't Be Reached
- Verify UNIVERSITY_PORTAL_URL is set in backend
- Check portal service is healthy

## 📝 Important Notes

- **Free Tier**: Services on free tier spin down after 15 minutes of inactivity
- **Cold Starts**: First request after spin-down may take 30-60 seconds
- **Database**: Using SQLite with ephemeral storage - data persists during runtime but may be lost on redeploy
- **File Uploads**: Stored in `/tmp` - files are ephemeral on free tier

## 🔐 Security Recommendations

For production deployment:

1. **Replace `CORS_ORIGIN: "*"` with specific frontend URL**
2. **Use strong SECRET_KEY for portal**
3. **Consider upgrading to paid tier for:**
   - Persistent storage
   - No cold starts
   - Better performance
4. **Use PostgreSQL for persistent database** (replace SQLite)

## 📞 Support

If you encounter issues:
1. Check Render service logs
2. Verify all environment variables
3. Ensure GitHub repository is up to date
4. Review health check endpoints

---

**Ready for Deployment!** 🎉

Your application is configured and ready to deploy on Render using the provided `render.yaml` blueprint.
